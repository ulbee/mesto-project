(()=>{"use strict";var e=function(e,t){var r=e.querySelector(t.submitButtonSelector);!function(e,t){return Array.from(e.querySelectorAll(t.inputSelector)).some((function(e){return!e.validity.valid}))}(e,t)?(r.classList.remove(t.inactiveButtonClass),r.removeAttribute("disabled")):(r.classList.add(t.inactiveButtonClass),r.setAttribute("disabled",!0))},t="popup_opened",r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},n=document.querySelectorAll(".".concat("popup")),o=function(e){e.classList.remove(t),s()},c=function(e){e.classList.add(t),l()},a=function(e){e.querySelector(r.submitButtonSelector).textContent="Сохранение..."},i=function(e){var t=e.querySelector(r.submitButtonSelector),n=t.value||"Сохранить";t.textContent=n},u=function(e){"Escape"===e.key&&o(document.querySelector(".".concat(t)))},l=function(){document.addEventListener("keydown",u)},s=function(){document.removeEventListener("keydown",u)};n.forEach((function(e){e.addEventListener("mousedown",(function(r){r.target.classList.contains(t)&&o(e),r.target.classList.contains("popup__close")&&o(e)}))}));var d,f,p,v,m={baseUrl:"https://nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"36c8d5bf-5129-4f58-81ea-48641e8f9a0a","Content-Type":"application/json"}},S=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},y=document.querySelector(".profile"),_=y.querySelector(".profile__avatar"),h=y.querySelector(".profile__title"),q=y.querySelector(".profile__subtitle"),b=function(){return d},L=document.querySelector("#card").content,g=document.querySelector("#card-delete-button").content,E=".card",C="card__like_active",k=".card__likes-number",x=document.querySelector("#showPicture"),A=x.querySelector(".popup__image"),U=x.querySelector(".popup__image-title"),T=function(e){var t=L.cloneNode(!0),r=t.querySelector(E),n=r.querySelector(".card__image"),o=r.querySelector(".card__title"),c=r.querySelector(".card__like"),a=r.querySelector(k),i=b();return r.id=e._id,n.src=e.link,n.alt=e.name,o.textContent=e.name,a.textContent=e.likes.length,e.owner._id===i&&P(r),e.likes.find((function(e){return e._id===i}))&&c.classList.add(C),B(c),n.addEventListener("click",(function(e){w(e)})),t},P=function(e){var t=g.cloneNode(!0);e.prepend(t),e.querySelector(".card__delete").addEventListener("click",(function(e){var t,r=e.target.closest(E);(t=r.id,fetch("".concat(m.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:m.headers}).then(S)).then((function(){r.remove()})).catch((function(e){console.log(e)}))}))},B=function(e){e.addEventListener("click",(function(e){var t=e.target.closest(E),r=t.querySelector(k),n=e.target.classList.contains(C)?"delete":"save";(function(e,t){var r="delete"===t?"DELETE":"PUT";return fetch("".concat(m.baseUrl,"/cards/likes/").concat(e),{method:r,headers:m.headers}).then(S)})(t.id,n).then((function(t){"delete"===n?e.target.classList.remove(C):e.target.classList.add(C),r.textContent=t.likes.length})).catch((function(e){console.log(e)}))}))},w=function(e){var t=e.target.src,r=e.target.alt;A.src=t,A.alt=r,U.textContent=r,c(x)},D=document.querySelector(".cards"),N=document.querySelector(".profile"),O=N.querySelector(".profile__avatar-edit-button"),j=N.querySelector(".profile__avatar"),J=N.querySelector(".profile__edit-button"),H=N.querySelector(".profile__title"),z=N.querySelector(".profile__subtitle"),I=N.querySelector(".profile__add-button"),M=document.querySelector("#editUserAvatar"),F=M.querySelector(r.formSelector),G=F.querySelector("".concat(r.inputSelector,'[name="url"]')),K=document.querySelector("#editUserInfo"),Q=K.querySelector(r.formSelector),R=Q.querySelector("".concat(r.inputSelector,'[name="name"]')),V=Q.querySelector("".concat(r.inputSelector,'[name="additional-info"]')),W=document.querySelector("#addPicture"),X=W.querySelector(r.formSelector),Y=X.querySelector("".concat(r.inputSelector,'[name="title"]')),Z=X.querySelector("".concat(r.inputSelector,'[name="link"]'));f=fetch("".concat(m.baseUrl,"/users/me"),{headers:m.headers}).then(S),p=fetch("".concat(m.baseUrl,"/cards"),{headers:m.headers}).then(S),Promise.all([f,p]).then((function(e){var t;t=e[0],h.textContent=t.name,q.textContent=t.about,_.src=t.avatar,d=t._id,function(e,t){t.forEach((function(t){var r=T(t);e.append(r)}))}(D,e[1])})).catch((function(e){console.log("Ошибка: "+e)})),v=r,Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){var r=Array.from(t.querySelectorAll(v.inputSelector));e(t,v),r.forEach((function(r){r.addEventListener("input",(function(){r.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"__error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(t,r,v):function(e,t,r){var n=e.querySelector(".".concat(t.id,"__error"));t.classList.add(r.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(r.errorClass)}(t,r,v),e(t,v)}))}))})),J.addEventListener("click",(function(){R.value=H.innerText,V.value=z.innerText,c(K)})),O.addEventListener("click",(function(e){c(M)})),I.addEventListener("click",(function(){c(W)})),Q.addEventListener("submit",(function(e){var t;e.preventDefault(),a(K),(t={name:R.value,about:V.value},fetch("".concat(m.baseUrl,"/users/me"),{method:"PATCH",headers:m.headers,body:JSON.stringify(t)}).then(S)).then((function(e){H.textContent=e.name,z.textContent=e.about,o(K)})).catch((function(e){return console.log(e)})).finally((function(){i(K)}))})),F.addEventListener("submit",(function(t){var n;t.preventDefault(),a(M),(n=G.value,fetch("".concat(m.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:m.headers,body:JSON.stringify({avatar:n})}).then(S)).then((function(n){j.src=n.avatar,o(M),F.reset(),e(t.target,r)})).catch((function(e){return console.log(e)})).finally((function(){i(M)}))})),X.addEventListener("submit",(function(t){var n,c;t.preventDefault(),a(W),(n=D,c={name:Y.value,link:Z.value},function(e){return fetch("".concat(m.baseUrl,"/cards"),{method:"POST",headers:m.headers,body:JSON.stringify(e)}).then(S)}(c).then((function(e){var t=T(e);n.prepend(t)})).catch((function(e){console.log(e)}))).then((function(){o(W),t.target.reset(),e(t.target,r)})).catch((function(e){return console.log(e)})).finally((function(){i(W)}))}))})();